{"version":3,"sources":["../src/conf.js"],"names":["fs","require","os","inquirer","CONFIG","homedir","QUESTIONS","type","name","message","choices","canditates","findProfiles","push","when","answer","chrome_profile_path","validate","value","accessSync","e","default","findOneTabExtensionID","undefined","loadConfig","requests","resolve","reject","config","JSON","parse","readFileSync","code","qs","forEach","concat","prompt","then","result","answers","length","saveConfig","console","info","PROFILE_DIRS","dirs","platform","profiles","statSync","dir","isDirectory","profileDir","extsDir","id","readdirSync","extDir","ext","toString","versionDir","version","file","writeFileSync","load","save"],"mappings":"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","file":"conf.js","sourcesContent":["const fs = require(\"fs\");\nconst os = require(\"os\");\n\nconst inquirer = require(\"inquirer\");\n\nconst CONFIG = os.homedir() + \"/.onetab-sync.json\"\n\nconst QUESTIONS = {\n    \"chrome_profile_path\": [{\n        type: \"list\",\n        name: \"chrome_profile_path\",\n        message: \"Select the path to user profile directory of Chrome \",\n        choices: () => {\n            let canditates = findProfiles();\n            canditates.push(\"custom\");\n            return canditates;\n        },\n    }, {\n        type: \"input\",\n        name: \"chrome_profile_path\",\n        when: (answer) => answer && answer.chrome_profile_path === \"custom\",\n        message: \"Please input\",\n        validate: (value) => {\n            try {\n                fs.accessSync(value);\n                return true;\n            } catch (e) {\n                return false;\n            }\n        },\n    }],\n    \"onetab_ext_id\": [{\n        type: \"input\",\n        name: \"onetab_ext_id\",\n        default: (answer) => {\n            return answer.chrome_profile_path ? findOneTabExtensionID(answer.chrome_profile_path) : undefined\n        },\n        message: \"Input the extension ID of OneTab.\",\n        validate: (value) => !!value,\n    }],\n    \"gist_token\": [{\n        type: \"input\",\n        name: \"gist_token\",\n        message: \"Input your gist access token.\",\n        validate: (value) => !!value,\n    }],\n    \"gist_id\": [{\n        type: \"input\",\n        name: \"gist_id\",\n        message: \"Input the gist ID which OneTab data is stored.\",\n        validate: (value) => !!value,\n    }],\n};\n\nconst loadConfig = (requests) => {\n    return new Promise((resolve, reject) => {\n        let config = {}\n        try {\n            config = JSON.parse(fs.readFileSync(CONFIG));\n        } catch(e) {\n            if (e.code !== \"ENOENT\") {\n                reject(e);\n            }\n        }\n\n        let qs = []\n        requests.forEach(name => {\n            if (!config[name]) {\n                qs = qs.concat(QUESTIONS[name]);\n            }\n        });\n        inquirer.prompt(qs).then(answers => {\n            let result = Object.assign(config, answers);\n            if (Object.keys(answers).length > 0) {\n                saveConfig(result);\n                console.info(\"configuration is saved in \" + CONFIG);\n            }\n            resolve(result);\n        });\n    });\n};\n\nconst PROFILE_DIRS = {\n    \"win32\": [\n        os.homedir() + \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\User Data\\\\Default\",\n        os.homedir() + \"\\\\AppData\\\\Local\\\\Google\\\\Chrome SxS\\\\User Data\\\\Default\",\n        os.homedir() + \"\\\\AppData\\\\Local\\\\Chromium\\\\User Data\\\\Default\",\n        os.homedir() + \"\\\\AppData\\\\Local\\\\Vivaldi\\\\User Data\\\\Default\",\n    ],\n    \"linux\": [\n        os.homedir() + \"/.config/google-chrome/Default\",\n        os.homedir() + \"/.config/google-chrome-beta/Default\",\n        os.homedir() + \"/.config/google-chrome-unstable/Default\",\n        os.homedir() + \"/.config/chromium/Default\",\n        os.homedir() + \"/.config/vivaldi/Default\",\n    ],\n    \"darwin\": [\n        os.homedir() + \"/Library/Application Support/Google/Chrome/Default\",\n        os.homedir() + \"~/Library/Application Support/Google/Chrome Canary/Default\",\n        os.homedir() + \"~/Library/Application Support/Chromium/Default\",\n        os.homedir() + \"~/Library/Application Support/Vivaldi/Default\",\n    ]\n}\nconst findProfiles = () => {\n    const dirs = PROFILE_DIRS[os.platform()];\n    let profiles = [];\n    if (dirs) {\n        dirs.forEach(dir => {\n            try {\n                if (fs.statSync(dir).isDirectory()) {\n                    profiles.push(dir);\n                }\n            } catch (e) { /* skip */ }\n        })\n    }\n    return profiles;\n};\n\nconst findOneTabExtensionID = (profileDir) => {\n    let extsDir = profileDir + \"/Extensions\";\n    let id = undefined;\n    fs.readdirSync(extsDir).forEach(ext => {\n        try {\n            let extDir = extsDir + \"/\" + ext.toString();\n            fs.readdirSync(extDir).forEach(version => {\n                let versionDir = extDir + \"/\" + version.toString();\n                try {\n                    fs.readdirSync(versionDir).forEach(file => {\n                        if (file.toString() === \"onetab.html\") {\n                            id = ext.toString();\n                        }\n                    })\n                } catch (e) { /* skip */ }\n            })\n        } catch (e) { /* skip */ }\n    });\n    return id;\n};\n\nconst saveConfig = (value) => {\n    fs.writeFileSync(CONFIG, JSON.stringify(value));\n};\n\nexport default {\n    load: loadConfig,\n    save: saveConfig,\n};\n"]}