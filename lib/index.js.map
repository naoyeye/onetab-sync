{"version":3,"sources":["../src/index.js"],"names":["fs","require","program","uploadToGist","console","info","conf","load","config","readOneTabData","oneTabData","gist","upload","res","html_url","error","downloadFromGist","download","data","metadata","backup","restoreOneTabData","syncWithGist","detectDownloadOrUpload","restoreFromFile","file","content","readFileSync","toString","db","get","result","close","reject","Error","message","put","then","lastsync","catch","pkginfo","JSON","parse","__dirname","version","description","command","action","undefined","noHelp","help","process","argv","args","length"],"mappings":";;;;;;;;;;;;;;;;;;AAIA;;;;AACA;;;;AACA;;;;;;AANA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;;AAEA,IAAMC,UAAUD,QAAQ,WAAR,CAAhB;;AAMA,IAAME;AAAA,wFAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBC,gCAAQC,IAAR,CAAa,4BAAb;AADiB;AAAA;AAAA,+BAGMC,eAAKC,IAAL,CAAU,CAAC,qBAAD,EAAwB,eAAxB,EAAyC,YAAzC,CAAV,CAHN;;AAAA;AAGTC,8BAHS;AAAA;AAAA,+BAIUC,eAAeD,MAAf,CAJV;;AAAA;AAITE,kCAJS;AAAA;AAAA,+BAKGC,eAAKC,MAAL,CAAYJ,MAAZ,EAAoBE,UAApB,CALH;;AAAA;AAKTG,2BALS;;AAMbT,gCAAQC,IAAR,CAAa,cAAcQ,IAAIC,QAA/B;AANa,yDAOND,GAPM;;AAAA;AAAA;AAAA;;AASbT,gCAAQW,KAAR;;AATa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAaA,IAAMC;AAAA,yFAAmB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACrBZ,gCAAQC,IAAR,CAAa,gCAAb;AADqB;AAAA;AAAA,+BAGEC,eAAKC,IAAL,CAAU,CAAC,qBAAD,EAAwB,eAAxB,EAAyC,YAAzC,EAAuD,SAAvD,CAAV,CAHF;;AAAA;AAGbC,8BAHa;AAAA;AAAA,+BAIYG,eAAKM,QAAL,CAAcT,MAAd,CAJZ;;AAAA;AAAA;AAAA;AAIZU,4BAJY;AAINC,gCAJM;AAAA;AAAA,+BAKMV,eAAeD,MAAf,CALN;;AAAA;AAKbE,kCALa;AAAA;AAAA,+BAMDC,eAAKS,MAAL,CAAYZ,MAAZ,EAAoBE,UAApB,CANC;;AAAA;AAMbG,2BANa;AAAA;AAAA,+BAOXQ,kBAAkBb,MAAlB,EAA0BU,IAA1B,CAPW;;AAAA;AAQjBd,gCAAQC,IAAR,CAAa,UAAb;AARiB,0DASVQ,GATU;;AAAA;AAAA;AAAA;;AAWjBT,gCAAQW,KAAR;;AAXiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAnB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAeA,IAAMO;AAAA,yFAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEMhB,eAAKC,IAAL,CAAU,CAAC,qBAAD,EAAwB,eAAxB,EAAyC,YAAzC,CAAV,CAFN;;AAAA;AAETC,8BAFS;AAAA;AAAA,+BAGAe,uBAAuBf,MAAvB,CAHA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAKbJ,gCAAQW,KAAR;;AALa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;AASA,IAAMS;AAAA,yFAAkB,kBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEGnB,eAAKC,IAAL,CAAU,CAAC,qBAAD,EAAwB,eAAxB,CAAV,CAFH;;AAAA;AAEZC,8BAFY;AAGZkB,+BAHY,GAGF1B,GAAG2B,YAAH,CAAgBF,IAAhB,EAAsBG,QAAtB,EAHE;AAAA;AAAA,+BAIAP,kBAAkBb,MAAlB,EAA0BkB,OAA1B,CAJA;;AAAA;AAIZb,2BAJY;;AAKhBT,gCAAQC,IAAR,CAAa,UAAb;AALgB,0DAMTQ,GANS;;AAAA;AAAA;AAAA;;AAQhBT,gCAAQW,KAAR;;AARgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAYA,IAAMN;AAAA,yFAAiB,kBAAOD,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEA,kBAAaA,MAAb,CAFA;;AAAA;AAEXqB,0BAFW;AAAA;AAAA,+BAGIA,GAAGC,GAAH,EAHJ;;AAAA;AAGXC,8BAHW;AAAA;AAAA,+BAITF,GAAGG,KAAH,EAJS;;AAAA;AAAA,0DAKRD,MALQ;;AAAA;AAAA;AAAA;AAAA,0DAOR,kBAAQE,MAAR,CACH,IAAIC,KAAJ,CAAU,mFAAmF,aAAEC,OAA/F,CADG,CAPQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAcA,IAAMd;AAAA,yFAAoB,kBAAOb,MAAP,EAAeU,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEH,kBAAaV,MAAb,CAFG;;AAAA;AAEdqB,0BAFc;AAAA;AAAA,+BAGCA,GAAGO,GAAH,CAAOlB,IAAP,CAHD;;AAAA;AAGda,8BAHc;AAAA;AAAA,+BAIZF,GAAGG,KAAH,EAJY;;AAAA;AAAA,0DAKXD,MALW;;AAAA;AAAA;AAAA;AAAA,0DAOX,kBAAQE,MAAR,CACH,IAAIC,KAAJ,CAAU,mFAAmF,aAAEC,OAA/F,CADG,CAPW;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAApB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAaA,IAAMZ,yBAAyB,SAAzBA,sBAAyB,CAACf,MAAD,EAAY;AACvCG,mBAAKM,QAAL,CAAcT,MAAd,EAAsB6B,IAAtB,CAA2B,iBAAsB;AAAA;AAAA,YAApBnB,IAAoB;AAAA,YAAdC,QAAc;;AAC7C,YAAIX,OAAO8B,QAAP,KAAoBnB,SAASmB,QAAjC,EAA2C;AACvC,mBAAOnC,cAAP;AACH,SAFD,MAEO;AACH,mBAAOa,kBAAP;AACH;AACJ,KAND,EAMGuB,KANH,CAMS;AAAA,eAAO1B,IAAIsB,OAAJ,KAAgB,WAAhB,GAA8BhC,cAA9B,GAA+CC,QAAQW,KAAR,CAAcF,GAAd,CAAtD;AAAA,KANT;AAOH,CARD;;AAWA,IAAM2B,UAAUC,KAAKC,KAAL,CAAW1C,GAAG2B,YAAH,CAAgBgB,YAAY,kBAA5B,CAAX,CAAhB;AACAzC,QACK0C,OADL,CACaJ,QAAQI,OADrB,EAEKC,WAFL,CAEiBL,QAAQK,WAFzB;;AAIA3C,QACK4C,OADL,CACa,QADb,EAEKD,WAFL,CAEiB,kCAFjB,EAGKE,MAHL,CAGY5C,YAHZ;;AAKAD,QACK4C,OADL,CACa,UADb,EAEKD,WAFL,CAEiB,sCAFjB,EAGKE,MAHL,CAGY/B,gBAHZ;;AAKAd,QACK4C,OADL,CACa,MADb,EAEKD,WAFL,CAEiB,4BAFjB,EAGKE,MAHL,CAGYzB,YAHZ;;AAKApB,QACK4C,OADL,CACa,gBADb,EAEKD,WAFL,CAEiB,sCAFjB,EAGKE,MAHL,CAGYvB,eAHZ;;AAKAtB,QACK4C,OADL,CACa,GADb,EACkBE,SADlB,EAC6B,EAACC,QAAQ,IAAT,EAD7B,EAEKF,MAFL,CAEY;AAAA,WAAM7C,QAAQgD,IAAR,EAAN;AAAA,CAFZ;;AAIAhD,QAAQwC,KAAR,CAAcS,QAAQC,IAAtB;AACA,IAAI,CAAClD,QAAQmD,IAAR,CAAaC,MAAlB,EAA0BpD,QAAQgD,IAAR","file":"index.js","sourcesContent":["const fs = require(\"fs\");\n\nconst program = require(\"commander\");\n\nimport gist from \"./gist\";\nimport openOneTabDB from \"./db\";\nimport conf from \"./conf\";\n\nconst uploadToGist = async () => {\n    console.info(\"uploading data to gist ...\");\n    try {\n        let config = await conf.load([\"chrome_profile_path\", \"onetab_ext_id\", \"gist_token\"]);\n        let oneTabData = await readOneTabData(config);\n        let res = await gist.upload(config, oneTabData);\n        console.info(\"success. \" + res.html_url);\n        return res;\n    } catch(e) {\n        console.error(e);\n    }\n};\n\nconst downloadFromGist = async () => {\n    console.info(\"downloading data from gist ...\");\n    try {\n        let config = await conf.load([\"chrome_profile_path\", \"onetab_ext_id\", \"gist_token\", \"gist_id\"]);\n        let [data, metadata] = await gist.download(config);\n        let oneTabData = await readOneTabData(config);\n        let res = await gist.backup(config, oneTabData);\n        await restoreOneTabData(config, data);\n        console.info(\"success.\");\n        return res;\n    } catch (e) {\n        console.error(e);\n    }\n};\n\nconst syncWithGist = async () => {\n    try {\n        let config = await conf.load([\"chrome_profile_path\", \"onetab_ext_id\", \"gist_token\"]);\n        return await detectDownloadOrUpload(config);\n    } catch (e) {\n        console.error(e);\n    }\n};\n\nconst restoreFromFile = async (file) => {\n    try {\n        let config = await conf.load([\"chrome_profile_path\", \"onetab_ext_id\"]);\n        let content = fs.readFileSync(file).toString();\n        let res = await restoreOneTabData(config, content)\n        console.info(\"success.\");\n        return res;\n    } catch (e) {\n        console.error(e);\n    }\n}\n\nconst readOneTabData = async (config) => {\n    try {\n        let db = await openOneTabDB(config);\n        let result = await db.get();\n        await db.close();\n        return result;\n    } catch (e) {\n        return Promise.reject(\n            new Error(\"can't open chrome localstorage db. If your browser is running, please quit it.\" + e.message)\n        );\n    }\n};\n\n\nconst restoreOneTabData = async (config, data) => {\n    try {\n        let db = await openOneTabDB(config);\n        let result = await db.put(data);\n        await db.close();\n        return result;\n    } catch (e) {\n        return Promise.reject(\n            new Error(\"can't open chrome localstorage db. If your browser is running, please quit it.\" + e.message)\n        );\n    }\n};\n\nconst detectDownloadOrUpload = (config) => {\n    gist.download(config).then(([data, metadata]) => {\n        if (config.lastsync === metadata.lastsync) {\n            return uploadToGist();\n        } else {\n            return downloadFromGist();\n        }\n    }).catch(res => res.message === \"Not Found\" ? uploadToGist() : console.error(res));\n};\n\n\nconst pkginfo = JSON.parse(fs.readFileSync(__dirname + \"/../package.json\"));\nprogram\n    .version(pkginfo.version)\n    .description(pkginfo.description);\n\nprogram\n    .command(\"upload\")\n    .description(\"force upload onetab data to gist\")\n    .action(uploadToGist);\n\nprogram\n    .command(\"download\")\n    .description(\"force download onetab data from gist\")\n    .action(downloadFromGist);\n\nprogram\n    .command(\"sync\")\n    .description(\"sync onetab data with gist\")\n    .action(syncWithGist);\n\nprogram\n    .command(\"restore <file>\")\n    .description(\"restore onetab data from backup file\")\n    .action(restoreFromFile);\n\nprogram\n    .command(\"*\", undefined, {noHelp: true})\n    .action(() => program.help());\n\nprogram.parse(process.argv);\nif (!program.args.length) program.help();\n\n"]}